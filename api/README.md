# شرح الكلاسات والوظائف في مجلد API

## **1. FaceComparer (`services_v2/face_comparer.py`)**

- **الوصف:**
  يقوم الكلاس بمقارنة متجهات الوجه لتحديد نسبة التشابه باستخدام خوارزميات رياضية.
- **الدوال:**
  - `compare_vectors(vector1, vector2)`:
    - المدخلات: متجهان يمثلان بيانات الوجه.
    - العمليات: حساب حاصل الضرب النقطي (Dot Product) والنسبية بين المتجهين.
    - المخرجات: قيمة التشابه كنسبة مئوية.

## **2. FaceDetector (`services/face_detector.py`)**

- **الوصف:**
  يكتشف مواقع الوجوه في الصور ويقوم بقص الوجه المكتشف إذا لزم الأمر.
- **الدوال:**
  - `detect_face(image)`:
    - المدخلات: صورة تم تحميلها.
    - العمليات: تستخدم مكتبة `face_recognition` لتحديد مواقع الوجه.
    - المخرجات: قائمة بمواقع الوجه المكتشف.
  - `detect_and_crop_face(image)`:
    - المدخلات: صورة تم تحميلها.
    - العمليات: تكتشف الوجه ثم تقصه كصورة جديدة.
    - المخرجات: الصورة المقصوصة للوجه.

## **3. ImageComparer (`services/image_comparer.py`)**

- **الوصف:**
  يحلل الصور ويقارنها من خلال استخراج متجهات الوجه.
- **الدوال:**
  - `image_to_vector(image_path)`:
    - المدخلات: مسار الصورة.
    - العمليات: تحميل الصورة واستخراج متجه الوجه باستخدام `face_recognition`.
    - المخرجات: متجه الوجه.

## **4. ImagePreprocessor (`services/image_preprocessor.py`)**

- **الوصف:**
  يُحسن الصور لجعلها مناسبة لتحليل الوجه.
- **الدوال:**
  - `enhance_image(image)`:
    - المدخلات: صورة.
    - العمليات: تغيير الأبعاد إلى 112x112 باستخدام مكتبة `cv2`.
    - المخرجات: الصورة المعدلة.

## **5. ImageVectorizer (`services/image_vectorizer.py`)**

- **الوصف:**
  يُنفذ سلسلة من العمليات لتحويل الصورة إلى متجه.
- **الدوال:**
  - `image_to_vector(image)`:
    - المدخلات: صورة.
    - العمليات:
      1. كشف الوجه.
      2. قص الوجه.
      3. تحسين الصورة.
      4. استخراج المتجه باستخدام `face_recognition`.
    - المخرجات: متجه الوجه.

## **6. StudentDataHandler (`services/student_data_handler.py`)**

- **الوصف:**
  يدير بيانات الطلاب ويقوم بعمليات على قاعدة البيانات.
- **الدوال:**
  - `generate_student_id`:
    - المدخلات: لا شيء.
    - العمليات: إيجاد أعلى معرف في قاعدة البيانات وتوليد معرف جديد.
    - المخرجات: رقم تعريف فريد.
  - `save_student(student_data)`:
    - المدخلات: بيانات الطالب (الاسم، الصورة).
    - العمليات: استخراج متجه الوجه وتخزين البيانات في قاعدة البيانات.
    - المخرجات: رسالة نجاح أو خطأ.
  - `fetch_students()`:
    - المدخلات: لا شيء.
    - العمليات: استرجاع جميع بيانات الطلاب من قاعدة البيانات.
    - المخرجات: قائمة بيانات الطلاب.

## **7. compare_image (`routes/compare_image.py`)**

- **الوصف:**
  يوفر واجهات API لمعالجة الصور ومقارنتها.
- **الدوال:**
  - استدعاء API لتحميل صورة ومقارنتها مع الصور المسجلة.
  - يستخدم `ImageComparer` لتحويل الصورة إلى متجه وإرجاع نتيجة المقارنة.

## **8. Students (`routes/students.py`)**

- **الوصف:**
  يحتوي على مسارات API لإدارة بيانات الطلاب.
- **الدوال:**
  - `add_student`: إضافة طالب جديد مع صورته.
  - `get_students`: استرجاع قائمة الطلاب.
  - يدمج خدمات معالجة الصور مع قاعدة البيانات.

---

## **الملاحظات العامة**

- **`main.py`:** الملف الرئيسي لتشغيل التطبيق.
  - يقوم بتجميع المسارات (Routes) وتشغيل التطبيق باستخدام FastAPI.
- **`database/database_manager.py`:** يحتوي على وظائف إدارة الاتصال بقاعدة البيانات وتنفيذ الاستعلامات.
